version: 2
jobs:
  build:
    docker:
      - image: circleci/node:9.6.1

    steps:
      - checkout

      - restore_cache: # gcloud install cache
          key: gcloud-cache
        
      - run: 
          name: install lsb-release package
          command: sudo apt-get install -y lsb-release curl

      - run: 
          name: install google cloud sdk 
          command: |
            export CLOUD_SDK_REPO="cloud-sdk-$(lsb_release -c -s)"
            echo "deb http://packages.cloud.google.com/apt $CLOUD_SDK_REPO main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
            curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
            sudo apt-get update && sudo apt-get install google-cloud-sdk

      - save_cache: # cache for gcloud install
          key: gcloud-cache
          paths:
          - /usr/lib/google-cloud-sdk
          - /usr/bin
          - /usr/include

      - run: 
          name: test gcloud 
          command: gcloud --version

